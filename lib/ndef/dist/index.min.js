"use strict";function t(t){return Buffer.from(t).toString()}Object.defineProperty(exports,"__esModule",{value:!0});var n={TNF_EMPTY:0,TNF_WELL_KNOWN:1,TNF_MIME_MEDIA:2,TNF_ABSOLUTE_URI:3,TNF_EXTERNAL_TYPE:4,TNF_UNKNOWN:5,TNF_UNCHANGED:6,TNF_RESERVED:7,RTD_TEXT:"T",RTD_URI:"U",RTD_SMART_POSTER:"Sp",RTD_ALTERNATIVE_CARRIER:"ac",RTD_HANDOVER_CARRIER:"Hc",RTD_HANDOVER_REQUEST:"Hr",RTD_HANDOVER_SELECT:"Hs",BLOCK_SIZE:16,TLV_START:64,TL_LENGTH:4},e=function(t){return Buffer.from(t)},r=["","http://www.","https://www.","http://","https://","tel:","mailto:","ftp://anonymous:anonymous@","ftp://ftp.","ftps://","sftp://","smb://","nfs://","ftp://","dav://","news:","telnet://","imap:","rtsp://","urn:","pop:","sip:","sips:","tftp:","btspp://","btl2cap://","btgoep://","tcpobex://","irdaobex://","file://","urn:epc:id:","urn:epc:tag:","urn:epc:pat:","urn:epc:raw:","urn:epc:","urn:nfc:"],o=function(t){return Buffer.from(t).toString()},i=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.TNF_EMPTY,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],p=arguments[4];return i instanceof Array&&(i=t(i)),s instanceof Array||(s=e(s)),c instanceof Array||(c=e(c)),o==n.TNF_WELL_KNOWN&&(i==n.RTD_TEXT?p=function(n){var e=63&n[0];n.slice(1,1+e);return t(n.slice(e+1))}(c):i==n.RTD_URI&&(p=function(n){var e=r[n[0]];return e||(e=""),e+t(n.slice(1))}(c))),{tnf:o,type:i,id:s,payload:c,value:p}},s=function(t){var n=[],r=void 0,o=void 0,i=void 0,s=void 0,c=void 0,u=void 0,f=void 0,T=void 0,a=void 0;for(c=0;c<t.length;c++)u=0===c,f=c===t.length-1,T=t[c].payload.length<255,a=t[c].id.length>0,r=p(u,f,!1,T,a,t[c].tnf),n.push(r),o=e(t[c].type),n.push(o.length),T?(i=t[c].payload.length,n.push(i)):(i=t[c].payload.length,n.push(i>>24),n.push(i>>16),n.push(i>>8),n.push(255&i)),a&&(s=t[c].id.length,n.push(s)),n=n.concat(o),a&&(n=n.concat(t[c].id)),n=n.concat(t[c].payload);return n},c=function(t){return{mb:0!=(128&t),me:0!=(64&t),cf:0!=(32&t),sr:0!=(16&t),il:0!=(8&t),tnf:7&t}},p=function(t,n,e,r,o,i){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:i;return t&&(s|=128),n&&(s|=64),e&&(s|=32),r&&(s|=16),o&&(s|=8),s};exports.record=i,exports.textRecord=function(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return i(n.TNF_WELL_KNOWN,n.RTD_TEXT,o,function(t,n,r){return n||(n="en"),e(n.length+n+t)}(t,r))},exports.uriRecord=function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i(n.TNF_WELL_KNOWN,n.RTD_URI,o,function(t){var n,o,i;return r.slice(1).forEach(function(e){n&&"urn:"!==n||0!==t.indexOf(e)||(n=e)}),n||(n=""),i=e(t.slice(n.length)),o=r.indexOf(n),i.unshift(o),i}(t))},exports.absoluteUriRecord=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return i(n.TNF_ABSOLUTE_URI,t,r,e)},exports.mimeMediaRecord=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return i(n.TNF_MIME_MEDIA,t,r,e)},exports.smartPoster=function(t,e,r){return r=[],t?r=t[0]instanceof Object&&t[0].hasOwnProperty("tnf")?s(t):t:console.warn("WARNING: Expecting an array of NDEF records"),i(n.TNF_WELL_KNOWN,n.RTD_SMART_POSTER,e,r)},exports.emptyRecord=function(){return i(n.TNF_EMPTY,[],[],[])},exports.androidApplicationRecord=function(t){return i(n.TNF_EXTERNAL_TYPE,"android.com:pkg",[],t)},exports.encodeMessage=s,exports.decodeMessage=function(t){for(var n=t.slice(0),e=[],r=void 0,o=void 0,s=0,p=0,u=0,f=[],T=[],a=[];n.length&&(r=n.shift(),o=c(r),s=n.shift(),p=o.sr?n.shift():(255&n.shift())<<24|(255&n.shift())<<16|(255&n.shift())<<8|255&n.shift(),o.il&&(u=n.shift()),f=n.splice(0,s),T=n.splice(0,u),a=n.splice(0,p),e.push(i(o.tnf,f,T,a)),!o.me););return e},exports.decodeTnf=c,exports.encodeTnf=p,exports.isType=function(t,n,e){return t.tnf===n&&o(t)===o(e)};
