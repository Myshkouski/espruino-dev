"use strict";function time(e){timers$1[e]=Date.now()}function timeEnd(e){e in timers$1&&(console.log(e+": "+(Date.now()-timers$1[e]).toFixed(3)+"ms"),delete timers$1[e])}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function _Stream(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options={highWaterMark:e.highWaterMark||128}}function Buffer(){throw new Error("Buffer constructor is deprecated. Use Buffer.from() instead.")}function BufferState(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,{_buffer:[],length:0},e)}function toString(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function _flow(){var e=this;if(this._readableState.flowing){var t=this.read();t&&t.length&&_process.nextTick(function(){e._readableState.defaultEncoding==encodings.UTF8&&(t=toString(t)),e.emit("data",t,e._readableState.defaultEncoding)})}}function _end(){this._readableState.flowing=null,this._readableState.ended=!0}function _Readable(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._readableState=new BufferState({flowing:null,ended:!1,defaultEncoding:encodings.BINARY}),this.pipes=[],this._read=e.read.bind(this),!this._read)throw new TypeError("_read() is not implemented");if(!this._read instanceof Function)throw new TypeError("'options.read' should be a function, passed",_typeof(e.read))}function _readFromInternalBuffer(){var e,t=(e=this._writableState).nodes.apply(e,arguments);return this._writableState.needDrain&&this._writableState.length<this.options.highWaterMark&&(this._writableState.needDrain=!1,this.emit("drain")),t}function _flush(){var e=this,t=this._writableState;if(!t.corked)if(t.length){var n=function(n){n&&e.emit("error",n),t.consumed=!0,_process.nextTick(function(){_flush.call(e)})};if(!t.corked&&t.consumed)if(t.consumed=!1,this._writev){var r=_readFromInternalBuffer.call(this);this._writev(r,n)}else{var i=_readFromInternalBuffer.call(this,1)[0];this._write(i.chunk,i.encoding,n)}}else t.ended&&this.emit("finish")}function _Writable(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._write=t.write.bind(this),this._writableState=new BufferState({getBuffer:function(){return e._writableState._buffer},corked:0,consumed:!0,needDrain:!1,ended:!1,decodeStrings:!0})}function _Duplex(){}function _Duplex$1(){}function _read(e){}function _Transform(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Duplex$2.call(this,Object.assign({},e,{read:_read,write:e.transform}))}function _transform(e,t,n){this.push(e,t),n()}function _PassThrough(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Transform.call(this,Object.assign({},e,{transform:_transform}))}function _Schedule(){this.pending=Promise.resolve(null)}function series(e,t,n){var r=0;!function i(s){void 0!==s||r>=e.length?n&&n(s):setImmediate(function(){return t(i,e[r],r++,e)})}()}function _parse(e,t,n){var r=this._busState,i=r.incoming,s=r.watching,o=r.frame,a=0,_=0,u=!1;if(s.length)for(;a<e.length;a++){if(o.push(e[a]),!i.length)for(var c in s)try{i.push({patterns:s[c].patterns,callback:s[c].callback,currentPattern:s[c].patterns[0]instanceof Function?s[c].patterns[0]([]):s[c].patterns[0],arrayOffset:0,patternIndex:0,byteIndex:0,length:0})}catch(e){this.emit("error",e)}for(_=0;_<i.length;){var l=i[_],f=l.currentPattern[l.byteIndex];if(void 0===f||f===e[a])u=!0,l.byteIndex++;else if(f instanceof Array){if(u=!0,l.arrayOffset<=0&&f[0]>0&&(l.arrayOffset=f[0]),--l.arrayOffset>0)continue;l.byteIndex++}else if(f instanceof Function)try{u=!!f.call(this,e[a],l.length,o.slice(-l.length-1)),l.byteIndex++}catch(e){this.emit("error",e),u=!1}else u=!1;if(u)if(l.length++,l.byteIndex>=l.currentPattern.length)if(++l.patternIndex>=l.patterns.length){try{l.callback.call(this,o.splice(-l.length),l.pattern)}catch(e){this.emit("error",e)}i.splice(0)}else{var h=l.patterns[l.patternIndex];l.byteIndex=0;try{h instanceof Function?l.currentPattern=h(o.slice(-l.length)):l.currentPattern=h,_++}catch(e){this.emit("error",e),i.splice(_,1)}}else _++;else i.splice(_,1)}!i.length&&o.length&&this.emit("error",{msg:"Unparsed chunk",data:o.splice(0)})}else this.emit("error",new Error({msg:"Unexpected incoming data",data:e}));n()}function _write(e,t,n){var r=this,i=this.options.highWaterMark;if(e.length>i){for(var s=[],o=e.length,a=0;o>0;o-=i)!function(n,o){var _=e.slice(o,o+=i);s.push(function(e){return _parse.call(r,_,t,e)}),a=o}(0,a);series(s,n)}else _parse.apply(this,arguments)}function _Bus(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Writable.call(this,Object.assign({},e,{write:_write})),this._setup=e.setup.bind(this),this._busState={watching:[],incoming:[],frame:[],configured:!1}}function blink(e){return void 0===e&&(e=!status),e?blink.start():blink.stop(),!!status}function setup(e){var t=this;Serial1.setup(115200,{rx:B7,tx:B6}),Serial1.write(wakeup),Serial1.write(sam),_setTimeout(function(){Serial1.read(),Serial1.pipe(t)},1500),_setTimeout(function(){blink.once(LED1,20,function(){return _setTimeout(function(){return blink.once(LED1,20)},200)}),e()},2e3)}var loop=[{queue:[],immediatePush:!0,tick:!1},{queue:[],immediatePush:!0,tick:!1},{queue:[],immediatePush:!1,tick:!1}],tick=!1,asyncFlush=function(){for(var e in loop){if(loop[e].queue.length)if(loop[e].immediatePush){for(var t=0;t<loop[e].queue.length;t++)loop[e].queue[t]();loop[e].queue.splice(0)}else for(var n=loop[e].queue.splice(0),r=0;r<n.length;r++)n[r]();loop[e].tick=tick=!1}},asyncCall=function(e){return function(t){loop[e].queue.push(t),tick||loop[e].tick||(loop[e].tick=tick=!0,setTimeout(asyncFlush))}},nextTick=asyncCall(0),setImmediate=asyncCall(1),timeoutCall=asyncCall(2),_setTimeout=function(e,t){return setTimeout(function(){timeoutCall(e)},t)},_process="undefined"!=typeof process?process:{};_process.nextTick=void 0!==_process.nextTick?_process.nextTick:nextTick;var timers$1={};"function"!=typeof console.time&&(console.time=time,console.timeEnd=timeEnd),"function"!=typeof console.error&&(console.error=console.log),Object.assign=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=n,s=Array.isArray(i),o=0,i=s?i:i[Symbol.iterator]();;){var a;if(s){if(o>=i.length)break;a=i[o++]}else{if((o=i.next()).done)break;a=o.value}var _=a;if(_ instanceof Object)for(var u in _)e[u]=_[u]}return e};var defProp=function(e,t,n){try{return Object.defineProperty(e,t,n),e}catch(r){return n.get?e.value=n.get():n.value&&(e[t]=n.value),e}},_named=function(e,t){return defProp(t,"name",{value:e}),t},SUPER_CHAIN_PROTO_PROP="_super",SUPER_CHAIN_APPLY_PROP="_apply",PROTOTYPE_IS_EXTENDED_PROP="_isExtended",_copyChain=function(e,t,n,r){e.prototype[n]||defProp(e.prototype,n,{value:[]}),t.forEach(function(t){var i=!!t.prototype[PROTOTYPE_IS_EXTENDED_PROP],s=!!t.prototype[n],o=e.prototype[n].some(function(e){return e===t}),a=!(i&&r||o);i&&s&&t.prototype[n].forEach(function(t){e.prototype[n].some(function(e){return e===t})||e.prototype[n].push(t)}),a&&e.prototype[n].push(t)})},_extend=function(){function e(){var t=this,n=arguments;e.prototype[SUPER_CHAIN_APPLY_PROP].forEach(function(r){r!==e&&r.apply(t,n)})}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.apply||(t.apply=[]),t.super||(t.super=[]),t.static||(t.static=[]);var n=t.super[0];t.name||(t.name=n.name),_named(t.name,e);for(var r in t.static)for(var i in t.static[r])"prototype"!=i&&defProp(e,i,{value:proto[i],enumerable:!0,writable:!0});defProp(e,"prototype",{value:{}}),defProp(e.prototype,"constructor",{value:n}),defProp(e.prototype,PROTOTYPE_IS_EXTENDED_PROP,{value:!0});for(var s in t.super){var o=function(){};o.prototype=t.super[s].prototype;var a=new o;for(var _ in a)["constructor",PROTOTYPE_IS_EXTENDED_PROP,SUPER_CHAIN_PROTO_PROP,SUPER_CHAIN_APPLY_PROP].indexOf(_)<0&&defProp(e.prototype,_,{value:a[_],enumerable:!0,writable:!0})}return _copyChain(e,t.super,SUPER_CHAIN_PROTO_PROP,!1),_copyChain(e,t.apply,SUPER_CHAIN_APPLY_PROP,!0),e};Array.prototype.concat=function(){var e=[];for(var t in this)e.push(this[t]);for(var n in arguments)for(var r in arguments[n])e.push(arguments[n][r]);return e},Promise.race||(Promise.race=function(e){if(!(e instanceof Array))throw new TypeError("You must pass an array to Promise.race().");return new Promise(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})});var events=EventEmitter;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,r,i,s,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(isObject(n))for(i=Array.prototype.slice.call(arguments,1),r=(o=n.slice()).length,s=0;s<r;s++)o[s].apply(this,i);return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,r,i,s;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,r=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(s=i;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};var Stream=_extend({name:"Stream",super:[events],apply:[events,_named("Stream",_Stream)]});Stream.prototype.emit=function(e,t){if("error"===e&&!this["#onerror"]&&!this._events.error)throw new Error(t);return events.prototype.emit.apply(this,arguments)},Buffer.from=function(){var e=[];if("string"==typeof arguments[0]){for(var t in arguments[0])e[t]=arguments[0].charCodeAt(t);e=new Uint8Array(e)}else(arguments[0]instanceof Uint8Array||arguments[0]instanceof Array)&&(e=new Uint8Array(arguments[0]));for(var n=void 0!==arguments[1]?arguments[1]:0,r=void 0!==arguments[2]?arguments[2]:e.length,i=[],s=n;s--;)i[s]=0;for(var o=0;o<e.length&&o<r;o++)i[n+o]=e[o];for(var a=i.length;a<r;a++)i[a]=0;return new Uint8Array(i)},Buffer.concat=function(){var e=arguments[0]||[],t=void 0!==arguments[1]?arguments[1]:e.reduce(function(e,t){return e+t.length},0),n=Buffer.from([],0,t),r=0;return e.forEach(function(e){n.set(e,r),r+=e.length}),n},BufferState.prototype={push:function(e){var t={chunk:Buffer.from(e),next:null};return this._buffer.length&&(this._buffer[this._buffer.length-1].next=t),this._buffer.push(t),this.length+=t.chunk.length,this.length},unshift:function(e){var t={chunk:Buffer.from(e),encoding:"binary",next:null};return this._buffer.length&&(t.next=this._buffer[0]),this._buffer.unshift(t),this.length+=t.chunk.length,this.length},nodes:function(e){var t=this,n=this._buffer.splice(0,e);return n.forEach(function(e){return t.length-=e.chunk.length}),n},at:function(e){if(!(e>=this.length||e<0))for(var t=0;t<this._buffer.length;t++){if(e<this._buffer[t].chunk.length)return{index:e,nodeIndex:t};e-=this._buffer[t].chunk.length}},buffer:function(e){if(void 0===e&&(e=this.length),!this.length)return Buffer.from([]);e>this.length&&(e=this.length);var t=void 0;e&&(t=this.at(e)),t||(t={index:this.length-1,nodeIndex:this._buffer.length-1});var n=Buffer.from([],0,e),r=this.nodes(t.nodeIndex).reduce(function(e,t){return n.set(t.chunk,e),e+=t.chunk.length},0);if(r<e){var i=this.nodes(1).shift();n.set(i.chunk.slice(0,e-r),r),i.chunk=i.chunk.slice(e-r),this.unshift(i)}return n}};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},encodings={BINARY:"binary",UTF8:"utf8"};_Readable.prototype={pause:function(){return!1!==this._readableState.flowing&&(this._readableState.flowing=!1,this.emit("pause")),this},resume:function(){return this._readableState.flowing||(this._readableState.flowing=!0,this.emit("resume"),_flow.call(this)),this},read:function(e){if(e<0)throw new Error('"length" must be more than 0');return this._readableState.ended||(void 0===e?this._readableState.length<this.options.highWaterMark&&this._read(this.options.highWaterMark-this._readableState.length):e>this._readableState.length&&this._read(e-this._readableState.length)),this._readableState.ended?this._readableState.length?this._readableState.buffer():null:void 0!==e&&this._readableState.length<e?null:this._readableState.buffer(e)},push:function(e){if(null===e)return _end.call(this),!1;var t=this._readableState.push(e)>this.options.highWaterMark;return t||_flow.call(this),!t},pipe:function(e){var t=this;if(!this.pipes.some(function(e){e.writable})){var n=function(n,r){e.write(n)||(r.stopped=!0,t.pause(),e.once("drain",function(){t.resume()}))},r={writable:e,listener:n,stopped:void 0};this.on("data",function(e){n(e,r)}).pipes.push(r),e instanceof Stream&&e.emit("pipe")}return e},unpipe:function(e){if(e){var t=this.pipes.find(function(e){e.writable});t&&this.removeListener("data",t.listener)}else{for(var n in this.pipes)this.removeListener(this.pipes[n].listener);this.pipes.splice(0)}},on:function(e,t){return"data"==e&&this.resume(),Stream.prototype.on.apply(this,arguments)},removeListener:function(e,t){return"data"==e&&this.pause(),Stream.prototype.removeListener.apply(this,arguments)},isPaused:function(){return!this._readableState.flowing}};var Readable=_extend({name:"Readable",super:[Stream,_Readable],apply:[Stream,_named("Readable",_Readable)]});_Writable.prototype={write:function(e){var t=this._writableState;if(t.ended)throw new Error("Write after end");return this._writableState.push(e),_flush.call(this),t.length<this.options.highWaterMark},end:function(){return this.write.apply(this,arguments),this._writableState.ended=!0,this},cork:function(){this._writableState.corked++},uncork:function(){this._writableState.corked>0&&(this._writableState.corked--,_flush.call(this))}};var Writable=_extend({name:"Writable",super:[Stream,_Writable],apply:[Stream,_named("Writable",_Writable)]}),Duplex=_extend({name:"Duplex",super:[Readable,Writable],apply:[Readable,Writable,_named("Duplex",_Duplex)]});Duplex.prototype.on=function(){return Readable.prototype.on.apply(this,arguments),this};var Duplex$2=_extend({name:"Duplex",super:[Readable,Writable],apply:[Readable,Writable,_named("Duplex",_Duplex$1)]});Duplex$2.prototype.on=function(){return Readable.prototype.on.apply(this,arguments),this};var Transform=_extend({name:"Transform",super:[Duplex$2],apply:[_named("Transform",_Transform)]}),PassThrough=_extend({name:"PassThrough",super:[Transform],apply:[_PassThrough]});_Schedule.prototype={immediate:function(e){var t=this;return this.pending=Promise.all([this.pending,new Promise(function(t,n){e(t,n)}).catch(function(e){return t.emit("error",e)})]),this},deferred:function(e){var t=this;return this.pending=this.pending.then(function(t){return new Promise(function(t,n){e(t,n)})}).catch(function(e){return t.emit("error",e)}),this}};var Schedule=_extend({name:"Schedule",super:[events,_named("Schedule",_Schedule)],apply:[events,_named("Schedule",_Schedule)]});_Bus.prototype={setup:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.deferred(function(t){return e._busState.configured?Promise.reject("already configured"):(e._busState.configured=!0,e._setup.apply(e,[t].concat(n)))})},watch:function(e,t){var n={patterns:e,callback:t};return this._busState.watching.push(n),n},unwatch:function(e){if(e){var t=this._busState.watching.indexOf(e);t>=0&&this._busState.watching.splice(t,1)}else this._busState.watching.splice(0);return this},rx:function(e,t){var n=this,r=this.watch(e,function(e){var i=n._busState.watching.indexOf(r);i>=0&&n._busState.watching.splice(0,i+1),t(e)});return this},tx:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.deferred(function(){return console.log("tx"),"timeout"in n?new Promise(function(r,i){_setTimeout(function(){t.write(e),r()},n.timeout)}):(t.write(e),Promise.resolve())})},reset:function(){return this._busState.frame.splice(0),this._busState.incoming.splice(0),this}};var Bus=_extend({name:"Bus",super:[Writable,Schedule,_Bus],apply:[_Bus,Schedule]}),status=!1;blink.start=function(){status||(status=!0,blink.once(LED2,20,function e(){status&&_setTimeout(function(){return blink.once(LED2,20,e)},980)}))},blink.stop=function(){status&&(status=!1)},blink.once=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments[2];e.write(!0),_setTimeout(function(){e.write(!1),n&&n()},t)};var data={PN532_PREAMBLE:0,PN532_STARTCODE1:0,PN532_STARTCODE2:255,PN532_POSTAMBLE:0,PN532_HOST_TO_PN532:212,PN532_PN532_TO_HOST:213,PN532_COMMAND_DIAGNOSE:0,PN532_COMMAND_GETFIRMWAREVERSION:2,PN532_COMMAND_GETGENERALSTATUS:4,PN532_COMMAND_READREGISTER:6,PN532_COMMAND_WRITEREGISTER:8,PN532_COMMAND_READGPIO:12,PN532_COMMAND_WRITEGPIO:14,PN532_COMMAND_SETSERIALBAUDRATE:16,PN532_COMMAND_SETPARAMETERS:18,PN532_COMMAND_SAMCONFIGURATION:20,PN532_COMMAND_POWERDOWN:22,PN532_COMMAND_RFCONFIGURATION:50,PN532_COMMAND_RFREGULATIONTEST:88,PN532_COMMAND_INJUMPFORDEP:86,PN532_COMMAND_INJUMPFORPSL:70,PN532_COMMAND_INLISTPASSIVETARGET:74,PN532_COMMAND_INATR:80,PN532_COMMAND_INPSL:78,PN532_COMMAND_INDATAEXCHANGE:64,PN532_COMMAND_INCOMMUNICATETHRU:66,PN532_COMMAND_INDESELECT:68,PN532_COMMAND_INRELEASE:82,PN532_COMMAND_INSELECT:84,PN532_COMMAND_INAUTOPOLL:96,PN532_COMMAND_TGINITASTARGET:140,PN532_COMMAND_TGSETGENERALBYTES:146,PN532_COMMAND_TGGETDATA:134,PN532_COMMAND_TGSETDATA:142,PN532_COMMAND_TGSETMETADATA:148,PN532_COMMAND_TGGETINITIATORCOMMAND:136,PN532_COMMAND_TGRESPONSETOINITIATOR:144,PN532_COMMAND_TGGETTARGETSTATUS:138,PN532_WAKEUP:85,PN532_SPI_STATREAD:2,PN532_SPI_DATAWRITE:1,PN532_SPI_DATAREAD:3,PN532_SPI_READY:1,PN532_I2C_ADDRESS:36,PN532_I2C_READBIT:1,PN532_I2C_BUSY:0,PN532_I2C_READY:1,PN532_I2C_READYTIMEOUT:20,PN532_MIFARE_ISO14443A:0,MIFARE_CMD_AUTH_A:96,MIFARE_CMD_AUTH_B:97,MIFARE_CMD_READ:48,MIFARE_CMD_WRITE_4:162,MIFARE_CMD_WRITE_16:160,MIFARE_CMD_TRANSFER:176,MIFARE_CMD_DECREMENT:192,MIFARE_CMD_INCREMENT:193,MIFARE_CMD_RESTORE:194,NDEF_URIPREFIX_NONE:0,NDEF_URIPREFIX_HTTP_WWWDOT:1,NDEF_URIPREFIX_HTTPS_WWWDOT:2,NDEF_URIPREFIX_HTTP:3,NDEF_URIPREFIX_HTTPS:4,NDEF_URIPREFIX_TEL:5,NDEF_URIPREFIX_MAILTO:6,NDEF_URIPREFIX_FTP_ANONAT:7,NDEF_URIPREFIX_FTP_FTPDOT:8,NDEF_URIPREFIX_FTPS:9,NDEF_URIPREFIX_SFTP:10,NDEF_URIPREFIX_SMB:11,NDEF_URIPREFIX_NFS:12,NDEF_URIPREFIX_FTP:13,NDEF_URIPREFIX_DAV:14,NDEF_URIPREFIX_NEWS:15,NDEF_URIPREFIX_TELNET:16,NDEF_URIPREFIX_IMAP:17,NDEF_URIPREFIX_RTSP:18,NDEF_URIPREFIX_URN:19,NDEF_URIPREFIX_POP:20,NDEF_URIPREFIX_SIP:21,NDEF_URIPREFIX_SIPS:22,NDEF_URIPREFIX_TFTP:23,NDEF_URIPREFIX_BTSPP:24,NDEF_URIPREFIX_BTL2CAP:25,NDEF_URIPREFIX_BTGOEP:26,NDEF_URIPREFIX_TCPOBEX:27,NDEF_URIPREFIX_IRDAOBEX:28,NDEF_URIPREFIX_FILE:29,NDEF_URIPREFIX_URN_EPC_ID:30,NDEF_URIPREFIX_URN_EPC_TAG:31,NDEF_URIPREFIX_URN_EPC_PAT:32,NDEF_URIPREFIX_URN_EPC_RAW:33,NDEF_URIPREFIX_URN_EPC:34,NDEF_URIPREFIX_URN_NFC:35,PN532_GPIO_VALIDATIONBIT:128,PN532_GPIO_P30:0,PN532_GPIO_P31:1,PN532_GPIO_P32:2,PN532_GPIO_P33:3,PN532_GPIO_P34:4,PN532_GPIO_P35:5,PN532_SAM_NORMAL_MODE:1,PN532_SAM_VIRTUAL_CARD:2,PN532_SAM_WIRED_CARD:3,PN532_SAM_DUAL_CARD:4,PN532_BRTY_ISO14443A:0,PN532_BRTY_ISO14443B:3,PN532_BRTY_212KBPS:1,PN532_BRTY_424KBPS:2,PN532_BRTY_JEWEL:4,NFC_WAIT_TIME:30,NFC_CMD_BUF_LEN:64,NFC_FRAME_ID_INDEX:6},PN532_PREAMBLE=data.PN532_PREAMBLE,PN532_STARTCODE1=data.PN532_STARTCODE1,PN532_STARTCODE2=data.PN532_STARTCODE2,PN532_POSTAMBLE=data.PN532_POSTAMBLE,PN532_HOST_TO_PN532=data.PN532_HOST_TO_PN532,PN532_PN532_TO_HOST=data.PN532_PN532_TO_HOST,PN532_COMMAND_SAMCONFIGURATION=data.PN532_COMMAND_SAMCONFIGURATION,PN532_COMMAND_INLISTPASSIVETARGET=data.PN532_COMMAND_INLISTPASSIVETARGET,PN532_COMMAND_INDATAEXCHANGE=data.PN532_COMMAND_INDATAEXCHANGE,PN532_WAKEUP=data.PN532_WAKEUP,MIFARE_CMD_AUTH_A=data.MIFARE_CMD_AUTH_A,MIFARE_CMD_READ=data.MIFARE_CMD_READ,MIFARE_CMD_WRITE_4=data.MIFARE_CMD_WRITE_4,PN532_SAM_NORMAL_MODE=data.PN532_SAM_NORMAL_MODE,check=function(e){return!1&e.reduce(function(e,t){return e+=t},0)},LCS_std=function(e,t,n){return check(n.slice(-2))},CHECKSUM_std=function(e,t,n){return check(n.slice(5))},BODY_std=function(e){for(var t=[],n=0;n<e[3]-1;n++)t.push(void 0);return t},info=[[PN532_PREAMBLE,PN532_STARTCODE1,PN532_STARTCODE2,void 0,LCS_std,PN532_PN532_TO_HOST],BODY_std,[CHECKSUM_std,PN532_POSTAMBLE]],err=[[PN532_PREAMBLE,PN532_STARTCODE1,PN532_STARTCODE2,1,255,void 0,CHECKSUM_std,PN532_POSTAMBLE]],ack=[new Uint8ClampedArray([PN532_PREAMBLE,PN532_STARTCODE1,PN532_STARTCODE2,0,255,PN532_POSTAMBLE])],command=function(e){return new Uint8ClampedArray([PN532_PREAMBLE,PN532_STARTCODE1,PN532_STARTCODE2,255&e.length+1,255&~e.length,PN532_HOST_TO_PN532].concat(e,[~(255&e.reduce(function(e,t){return e+=t},1)),PN532_POSTAMBLE]))},data$2={TNF_EMPTY:0,TNF_WELL_KNOWN:1,TNF_MIME_MEDIA:2,TNF_ABSOLUTE_URI:3,TNF_EXTERNAL_TYPE:4,TNF_UNKNOWN:5,TNF_UNCHANGED:6,TNF_RESERVED:7,RTD_TEXT:"T",RTD_URI:"U",RTD_SMART_POSTER:"Sp",RTD_ALTERNATIVE_CARRIER:"ac",RTD_HANDOVER_CARRIER:"Hc",RTD_HANDOVER_REQUEST:"Hr",RTD_HANDOVER_SELECT:"Hs",BLOCK_SIZE:16,TLV_START:64,TL_LENGTH:4},decode=function(e){var t=63&e[0];e.slice(1,1+t);return Buffer.from(e.slice(t+1)).toString()},encode=function(e,t,n){return t||(t="en"),Buffer.from([t.length].concat([].slice.call(Buffer.from(t+e))))},protocols=["","http://www.","https://www.","http://","https://","tel:","mailto:","ftp://anonymous:anonymous@","ftp://ftp.","ftps://","sftp://","smb://","nfs://","ftp://","dav://","news:","telnet://","imap:","rtsp://","urn:","pop:","sip:","sips:","tftp:","btspp://","btl2cap://","btgoep://","tcpobex://","irdaobex://","file://","urn:epc:id:","urn:epc:tag:","urn:epc:pat:","urn:epc:raw:","urn:epc:","urn:nfc:"],decode$1=function(e){var t=protocols[e[0]];return t||(t=""),t+Buffer.from(e.slice(1)).toString()},record=function(e,t,n,r,i){return e||(e=data$2.TNF_EMPTY),t||(t=[]),n||(n=[]),r||(r=[]),t instanceof Array&&(t=Buffer.from(t).toString()),n instanceof Array||(n=Buffer.from(n)),r instanceof Array||(r=Buffer.from(r)),e==data$2.TNF_WELL_KNOWN&&(t==data$2.RTD_TEXT?i=decode(r):t==data$2.RTD_URI&&(i=decode$1(r))),{tnf:e,type:t,id:n,payload:r,value:i}},textRecord=function(e,t,n){return record(data$2.TNF_WELL_KNOWN,data$2.RTD_TEXT,n||[],encode(e,t))},encodeMessage=function(e){var t=[],n=void 0,r=void 0,i=void 0,s=void 0,o=void 0,a=void 0,_=void 0,u=void 0,c=void 0;for(o=0;o<e.length;o++)a=0===o,_=o===e.length-1,u=e[o].payload.length<255,c=e[o].id.length>0,n=encodeTnf(a,_,!1,u,c,e[o].tnf),t.push(n),r=[].slice.call(Buffer.from(e[o].type)),t.push(r.length),u?(i=e[o].payload.length,t.push(i)):(i=e[o].payload.length,t.push(i>>24),t.push(i>>16),t.push(i>>8),t.push(255&i)),c&&(s=e[o].id.length,t.push(s)),t=t.concat(r),c&&(t=t.concat(e[o].id)),t=t.concat([].slice.call(e[o].payload));return t},encodeTnf=function(e,t,n,r,i,s,o){return o||(o=s),e&&(o|=128),t&&(o|=64),n&&(o|=32),r&&(o|=16),i&&(o|=8),o};blink();var encoded=encodeMessage([textRecord("2enhello world!")]),wakeup=command([PN532_WAKEUP]),sam=command([PN532_COMMAND_SAMCONFIGURATION,PN532_SAM_NORMAL_MODE,20,0]),bus=new Bus({setup:setup,highWaterMark:64});bus.on("error",console.error),bus.setup(Serial1);var KEY=new Uint8ClampedArray([255,255,255,255,255,255]);!function e(){var t=void 0,n=4;bus.deferred(function(e){var n=command([PN532_COMMAND_INLISTPASSIVETARGET,1,0]);bus.rx(ack,function(){console.log("ACK")}),bus.rx(info,function(n){var r=n.slice(7,5+n[3]),i=r[5],s=r.slice(6,6+i);console.log("FOUND",[n[6],r[0],r.slice(2,4),r[4]][2]),t=s,e()}),Serial1.write(n)}),bus.deferred(function(e,r){var i=command([PN532_COMMAND_INDATAEXCHANGE,1,MIFARE_CMD_AUTH_A,n].concat(KEY).concat(t));bus.rx(ack,function(e){}),bus.rx(err,r),bus.rx(info,function(t){console.log("AUTH SUCCEED"),e()}),Serial1.write(i)}),bus.deferred(function(e,t){var r=command([PN532_COMMAND_INDATAEXCHANGE,1,MIFARE_CMD_WRITE_4,n].concat(encoded));bus.rx(ack,function(e){}),bus.rx(err,t),bus.rx(info,function(t){console.log("WRITE SUCCEED"),e()}),Serial1.write(r)}),bus.deferred(function(e,t){var r=command([PN532_COMMAND_INDATAEXCHANGE,1,MIFARE_CMD_READ,n]);bus.rx(ack,function(e){}),bus.rx(err,t),bus.rx(info,function(t){console.log("RED",t),e()}),Serial1.write(r)}),bus.deferred(function(t){_setTimeout(function(){console.log(_process.memory().free),t(),e()},1e3)})}();
//# sourceMappingURL=index.esp.min.js.map
