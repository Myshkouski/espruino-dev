"use strict";function n(){this.n={}}function t(n){n&&("#"+n in this?this.n[n]=this["#"+n]:delete this.n[n])}function r(){this.pending=Promise.resolve(null)}function i(n,t,r){var i=0;!function e(o){void 0!==o||i>=n.length?r&&r(o):w(function(){return t(e,n[i],i++,n)})}()}function e(n,t,r){var i=this.t,e=i.incoming,o=i.watching,u=i.frame,c=0,f=0,a=!1;if(o.length)for(;c<n.length;c++){if(u.push(n[c]),!e.length)for(var s in o)try{e.push({patterns:o[s].patterns,callback:o[s].callback,currentPattern:o[s].patterns[0]instanceof Function?o[s].patterns[0]([]):o[s].patterns[0],arrayOffset:0,patternIndex:0,byteIndex:0,length:0})}catch(n){this.emit("error",n)}for(f=0;f<e.length;){var v=e[f],h=v.currentPattern[v.byteIndex];if(void 0===h||h===n[c])a=!0,v.byteIndex++;else if(h instanceof Array){if(a=!0,v.arrayOffset<=0&&h[0]>0&&(v.arrayOffset=h[0]),--v.arrayOffset>0)continue;v.byteIndex++}else if(h instanceof Function)try{a=!!h.call(this,n[c],v.length,u.slice(-v.length-1)),v.byteIndex++}catch(n){this.emit("error",n),a=!1}else a=!1;if(a)if(v.length++,v.byteIndex>=v.currentPattern.length)if(++v.patternIndex>=v.patterns.length){try{v.callback.call(this,u.splice(-v.length),v.pattern)}catch(n){this.emit("error",n)}e.splice(0)}else{var l=v.patterns[v.patternIndex];v.byteIndex=0;try{v.currentPattern=l instanceof Function?l(u.slice(-v.length)):l,f++}catch(n){this.emit("error",n),e.splice(f,1)}}else f++;else e.splice(f,1)}!e.length&&u.length&&this.emit("error",{msg:"Unparsed chunk",data:u.splice(0)})}else this.emit("error",Error({msg:"Unexpected incoming data",data:n}));r()}function o(n,t,r){var o=this,u=this.options.highWaterMark;if(n.length>u){for(var c=[],f=n.length,a=0;f>0;f-=u)!function(r,i){var f=n.slice(i,i+=u);c.push(function(n){return e.call(o,f,t,n)}),a=i}(0,a);i(c,r)}else e.apply(this,arguments)}function u(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Writable.call(this,Object.assign({},n,{write:o})),this.r=n.setup.bind(this),this.t={watching:[],incoming:[],frame:[],configured:!1}}function c(n){return void 0===n&&(n=!E),n?c.start():c.stop(),!!E}function f(){throw Error("Buffer constructor is deprecated. Use Buffer.from() instead.")}var a={};"function"!=typeof console.time&&(console.time=function(n){a[n]=Date.now()},console.timeEnd=function(n){n in a&&(console.log(n+": "+(Date.now()-a[n]).toFixed(3)+"ms"),delete a[n])}),"function"!=typeof console.error&&(console.error=console.log),Object.assign=function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var e in r){var o=r[e];if(o instanceof Object)for(var u in o)n[u]=o[u]}return n};var s="_super",v="_apply",h="_isExtended",l=function(n,t,r,i){n.prototype[r]||Object.defineProperty(n.prototype,r,{value:[]}),t.forEach(function(t){var e=!!t.prototype[h],o=!!t.prototype[r],u=n.prototype[r].some(function(n){return n===t}),c=!(e&&i||u);e&&o&&t.prototype[r].forEach(function(t){n.prototype[r].some(function(n){return n===t})||n.prototype[r].push(t)}),c&&n.prototype[r].push(t)})};[].concat=function(){var n=[];for(var t in this)n.push(this[t]);for(var r in arguments)for(var i in arguments[r])n.push(arguments[r][i]);return n},Promise.race||(Promise.race=function(n){if(!(n instanceof Array))throw new TypeError("You must pass an array to Promise.race().");return new Promise(function(t,r){for(var i,e=0;e<n.length;e++)(i=n[e])&&"function"==typeof i.then?i.then(t,r):t(i)})}),_named("EventEmitter",n),n.prototype={on:function(n,r){return{}.on.call(this,n,r),t.call(this,n),this},removeListener:function(n,r){return{}.on.call(this,n,r),t.call(this,n),this},once:function(n,t){return this.on(n,function(){return this.removeListener(n,_listener),t.apply(this,arguments)})}},r.prototype={immediate:function(n){var t=this;return this.pending=Promise.all([this.pending,new Promise(function(t,r){n(t,r)}).catch(function(n){return t.emit("error",n)})]),this},deferred:function(n){var t=this;return this.pending=this.pending.then(function(t){return new Promise(function(t,r){n(t,r)})}).catch(function(n){return t.emit("error",n)}),this}};var p=[{queue:[],immediatePush:!0,tick:!1},{queue:[],immediatePush:!1,tick:!1}],d=!1,m=function(){for(var n in p){if(p[n].queue.length)if(p[n].immediatePush){for(var t=0;t<p[n].queue.length;t++)p[n].queue[t]();p[n].queue.splice(0)}else for(var r=p[n].queue.splice(0),i=0;i<r.length;i++)r[i]();p[n].tick=d=!1}},y=function(n){return function(t){p[n].queue.push(t),d||p[n].tick||(p[n].tick=d=!0,setTimeout(m))}},w=y(0);y(1),u.prototype={setup:function(){for(var n=this,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return this.deferred(function(t){return n.t.configured?Promise.reject("already configured"):(n.t.configured=!0,n.r.apply(n,[t].concat(r)))})},watch:function(n,t){var r={patterns:n,callback:t};return this.t.watching.push(r),r},unwatch:function(n){if(n){var t=this.t.watching.indexOf(n);t>=0&&this.t.watching.splice(t,1)}else this.t.watching.splice(0);return this},rx:function(n,t){var r=this,i=this.watch(n,function(n){var e=r.t.watching.indexOf(i);e>=0&&r.t.watching.splice(0,e+1),t(n)});return this},tx:function(n){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.deferred(function(){return console.log("tx"),"timeout"in r?new Promise(function(i,e){setTimeout(function(){t.write(n),i()},r.timeout)}):(t.write(n),Promise.resolve())})},reset:function(){return this.t.frame.splice(0),this.t.incoming.splice(0),this}};var b=function(){function n(){var t=this,r=arguments;n.prototype[v].forEach(function(i){i!==n&&i.apply(t,r)})}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.apply||(t.apply=[]),t.super||(t.super=[]),t.static||(t.static=[]);var r=t.super[0];t.name||(t.name=r.name),_named(t.name,n);for(var i in t.static)for(var e in t.static[i])"prototype"!=e&&defProp(n,e,{value:proto[e],enumerable:!0,writable:!0});Object.defineProperty(n,"prototype",{value:{}}),Object.defineProperty(n.prototype,"constructor",{value:r}),Object.defineProperty(n.prototype,h,{value:!0});for(var o in t.super){var u=function(){};u.prototype=t.super[o].prototype;var c=new u;for(var f in c)["constructor",h,s,v].indexOf(f)<0&&defProp(n.prototype,f,{value:c[f],enumerable:!0,writable:!0})}return l(n,t.super,s,!1),l(n,t.apply,v,!0),n}({name:"Bus",super:[Writable,r,u],apply:[u,r]}),E=!1;c.start=function(){E||(E=!0,c.once(LED2,20,function n(){E&&setTimeout(function(){return c.once(LED2,20,n)},980)}))},c.stop=function(){E&&(E=!1)},c.once=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=arguments[2];n.write(!0),setTimeout(function(){n.write(!1),r&&r()},t)};var A=0,P=0,U=255,T=212,g=64,S=96,x=162,D=function(n){return!1&n.reduce(function(n,t){return n+=t},0)},O=[[A,P,U,void 0,function(n,t,r){return D(r.slice(-2))},213],function(n){for(var t=[],r=0;r<n[3]-1;r++)t.push(void 0);return t},[function(n,t,r){return D(r.slice(5))},0]],C=[new Uint8ClampedArray([A,P,U,0,255,0])],R=function(n){return new Uint8ClampedArray([A,P,U,255&n.length+1,255&~n.length,T].concat(n,[~(255&n.reduce(function(n,t){return n+=t},1)),0]))};f.from=function(){var n=[];if("string"==typeof arguments[0]){for(var t in arguments[0])n[t]=arguments[0].charCodeAt(t);n=new Uint8Array(n)}else(arguments[0]instanceof Uint8Array||arguments[0]instanceof Array)&&(n=new Uint8Array(arguments[0]));for(var r=void 0!==arguments[1]?arguments[1]:0,i=void 0!==arguments[2]?arguments[2]:n.length,e=[],o=r;o--;)e[o]=0;for(var u=0;u<n.length&&u<i;u++)e[r+u]=n[u];for(var c=e.length;c<i;c++)e[c]=0;return new Uint8Array(e)},f.concat=function(){var n=arguments[0]||[],t=void 0!==arguments[1]?arguments[1]:n.reduce(function(n,t){return n+t.length},0),r=f.from([],0,t),i=0;return n.forEach(function(n){r.set(n,i),i+=n.length}),r};var j=function(n){var t=63&n[0];return n.slice(1,1+t),""+f.from(n.slice(t+1))},k=["","http://www.","https://www.","http://","https://","tel:","mailto:","ftp://anonymous:anonymous@","ftp://ftp.","ftps://","sftp://","smb://","nfs://","ftp://","dav://","news:","telnet://","imap:","rtsp://","urn:","pop:","sip:","sips:","tftp:","btspp://","btl2cap://","btgoep://","tcpobex://","irdaobex://","file://","urn:epc:id:","urn:epc:tag:","urn:epc:pat:","urn:epc:raw:","urn:epc:","urn:nfc:"],_=function(n){var t=k[n[0]];return t||(t=""),t+""+f.from(n.slice(1))},B=function(n,t,r,i,e,o,u){return u||(u=o),n&&(u|=128),t&&(u|=64),r&&(u|=32),i&&(u|=16),e&&(u|=8),u};c();var L=function(n){var t=[],r=void 0,i=void 0,e=void 0,o=void 0,u=void 0,c=void 0,a=void 0,s=void 0,v=void 0;for(u=0;u<n.length;u++)c=0===u,a=u===n.length-1,s=n[u].payload.length<255,v=n[u].id.length>0,r=B(c,a,!1,s,v,n[u].tnf),t.push(r),i=[].slice.call(f.from(n[u].type)),t.push(i.length),s?(e=n[u].payload.length,t.push(e)):(e=n[u].payload.length,t.push(e>>24),t.push(e>>16),t.push(e>>8),t.push(255&e)),v&&(o=n[u].id.length,t.push(o)),t=t.concat(i),v&&(t=t.concat(n[u].id)),t=t.concat([].slice.call(n[u].payload));return t}([function(n,t,r,i,e){return n||(n=0),t||(t=[]),r||(r=[]),i||(i=[]),t instanceof Array&&(t=""+f.from(t)),r instanceof Array||(r=f.from(r)),i instanceof Array||(i=f.from(i)),1==n&&("T"==t?e=j(i):"U"==t&&(e=_(i))),{tnf:n,type:t,id:r,payload:i,value:e}}(1,"T",[],function(n,t,r){return t||(t="en"),f.from([t.length].concat([].slice.call(f.from(t+"2enhello world!"))))}(0,void 0))]),F=R([85]),W=R([20,1,20,0]),I=new b({setup:function(n){var t=this;Serial1.setup(115200,{rx:B7,tx:B6}),Serial1.write(F),Serial1.write(W),setTimeout(function(){Serial1.read(),Serial1.pipe(t)},1500),setTimeout(function(){c.once(LED1,20,function(){return setTimeout(function(){return c.once(LED1,20)},200)}),n()},2e3)},highWaterMark:64});I.on("error",console.error),I.setup(Serial1);var q=new Uint8ClampedArray([255,255,255,255,255,255]);!function n(){var t=void 0,r=4;I.deferred(function(n){var r=R([74,1,0]);I.rx(C,function(){console.log("ACK")}),I.rx(O,function(r){var i=r.slice(7,5+r[3]),e=i[5],o=i.slice(6,6+e);console.log("FOUND",[r[6],i[0],i.slice(2,4),i[4]][2]),t=o,n()}),Serial1.write(r)}),I.deferred(function(n,i){var e=R([g,1,S,r].concat(q).concat(t));I.rx(C,function(n){}),I.rx(ERR,i),I.rx(O,function(t){console.log("AUTH SUCCEED"),n()}),Serial1.write(e)}),I.deferred(function(n,t){var i=R([g,1,x,r].concat(L));I.rx(C,function(n){}),I.rx(ERR,t),I.rx(O,function(t){console.log("WRITE SUCCEED"),n()}),Serial1.write(i)}),I.deferred(function(n,t){var i=R([g,1,48,r]);I.rx(C,function(n){}),I.rx(ERR,t),I.rx(O,function(t){console.log("RED",t),n()}),Serial1.write(i)}),I.deferred(function(t){setTimeout(function(){console.log(process.memory().free),t(),n()},1e3)})}();
//# sourceMappingURL=index.esp.min.js.map
